<p><a id='top'></a></p>

<h1>8. The Game Controller and View</h1>

<p>We want to be able to carry out the full RESTful actions on game:</p>

<ol>
<li>List - the index action</li>
<li>Create - the new &gt; create actions</li>
<li>Edit - the edit &gt; update actions</li>
<li>Show - the show action</li>
<li>Destroy - the destroy action</li>
</ol>

<p>So we&#39;re going to generate the controller, set the controller up as a RESTful resource in our routes, write the functional tests then make them all pass.</p>

<h2><a id='generate-the-controller'></a> 8.1. Generate the controller</h2>

<p>We&#39;ll tell the generator to all of the RESTful actions for us.</p>
<div class="highlight"><pre><span class="go">rails generate controller games index new create update edit show destroy</span>

<span class="go">create  app/controllers/games_controller.rb</span>
<span class="go">      route  get &quot;games/destroy&quot;</span>
<span class="go">      route  get &quot;games/show&quot;</span>
<span class="go">      route  get &quot;games/edit&quot;</span>
<span class="go">      route  get &quot;games/update&quot;</span>
<span class="go">      route  get &quot;games/create&quot;</span>
<span class="go">      route  get &quot;games/new&quot;</span>
<span class="go">      route  get &quot;games/index&quot;</span>
<span class="go">     invoke  erb</span>
<span class="go">     create    app/views/games</span>
<span class="go">     create    app/views/games/index.html.erb</span>
<span class="go">     create    app/views/games/new.html.erb</span>
<span class="go">     create    app/views/games/create.html.erb</span>
<span class="go">     create    app/views/games/update.html.erb</span>
<span class="go">     create    app/views/games/edit.html.erb</span>
<span class="go">     create    app/views/games/show.html.erb</span>
<span class="go">     create    app/views/games/destroy.html.erb</span>
<span class="go">     invoke  rspec</span>
<span class="go">     create    spec/controllers/games_controller_spec.rb</span>
<span class="go">     create    spec/views/games</span>
<span class="go">     create    spec/views/games/index.html.erb_spec.rb</span>
<span class="go">     create    spec/views/games/new.html.erb_spec.rb</span>
<span class="go">     create    spec/views/games/create.html.erb_spec.rb</span>
<span class="go">     create    spec/views/games/update.html.erb_spec.rb</span>
<span class="go">     create    spec/views/games/edit.html.erb_spec.rb</span>
<span class="go">     create    spec/views/games/show.html.erb_spec.rb</span>
<span class="go">     create    spec/views/games/destroy.html.erb_spec.rb</span>
<span class="go">     invoke  helper</span>
<span class="go">     create    app/helpers/games_helper.rb</span>
<span class="go">     invoke    rspec</span>
<span class="go">     create      spec/helpers/games_helper_spec.rb</span>
<span class="go">     invoke  assets</span>
<span class="go">     invoke    coffee</span>
<span class="go">     create      app/assets/javascripts/games.js.coffee</span>
<span class="go">     invoke    scss</span>
<span class="go">     create      app/assets/stylesheets/games.css.scss</span>
</pre></div>

<p>Let&#39;s create games as a RESTful resource in <code>config/routes.rb</code> by removing:</p>
<div class="highlight"><pre><span class="n">get</span> <span class="s2">&quot;games/index&quot;</span>

<span class="n">get</span> <span class="s2">&quot;games/new&quot;</span>

<span class="n">get</span> <span class="s2">&quot;games/create&quot;</span>

<span class="n">get</span> <span class="s2">&quot;games/update&quot;</span>

<span class="n">get</span> <span class="s2">&quot;games/edit&quot;</span>

<span class="n">get</span> <span class="s2">&quot;games/show&quot;</span>

<span class="n">get</span> <span class="s2">&quot;games/destroy&quot;</span>
</pre></div>

<p>and creating games as a resource. Since we&#39;re using all of the RESTful actions then we don&#39;t need to limit it with <code>:only =&gt;[]</code> </p>
<div class="highlight"><pre><span class="no">Stinkytrainers</span><span class="o">::</span><span class="no">Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>


  <span class="n">devise_for</span> <span class="ss">:users</span>

  <span class="n">resources</span> <span class="ss">:sports</span><span class="p">,</span> <span class="ss">:only</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:index</span><span class="p">,</span> <span class="ss">:new</span><span class="p">,</span> <span class="ss">:create</span><span class="p">,</span> <span class="ss">:destroy</span><span class="o">]</span>

  <span class="n">resources</span> <span class="ss">:dashboard</span><span class="p">,</span> <span class="ss">:only</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:index</span><span class="o">]</span> 

  <span class="n">resources</span> <span class="ss">:games</span>

  <span class="n">root</span> <span class="ss">:to</span> <span class="o">=&gt;</span> <span class="s1">&#39;home#index&#39;</span>

<span class="k">end</span>
</pre></div>

<p>Take a look at the routes we&#39;ve created</p>
<div class="highlight"><pre><span class="go">bundle exec rake routes</span>

<span class="go"> new_user_session GET    /users/sign_in(.:format)                  devise/sessions#new</span>
<span class="go">            user_session POST   /users/sign_in(.:format)                  devise/sessions#create</span>
<span class="go">    destroy_user_session DELETE /users/sign_out(.:format)                 devise/sessions#destroy</span>
<span class="go">           user_password POST   /users/password(.:format)                 devise/passwords#create</span>
<span class="go">       new_user_password GET    /users/password/new(.:format)             devise/passwords#new</span>
<span class="go">      edit_user_password GET    /users/password/edit(.:format)            devise/passwords#edit</span>
<span class="go">                         PUT    /users/password(.:format)                 devise/passwords#update</span>
<span class="go">cancel_user_registration GET    /users/cancel(.:format)                   devise/registrations#cancel</span>
<span class="go">       user_registration POST   /users(.:format)                          devise/registrations#create</span>
<span class="go">   new_user_registration GET    /users/sign_up(.:format)                  devise/registrations#new</span>
<span class="go">  edit_user_registration GET    /users/edit(.:format)                     devise/registrations#edit</span>
<span class="go">                         PUT    /users(.:format)                          devise/registrations#update</span>
<span class="go">                         DELETE /users(.:format)                          devise/registrations#destroy</span>
<span class="go">                  sports GET    /sports(.:format)                         sports#index</span>
<span class="go">                         POST   /sports(.:format)                         sports#create</span>
<span class="go">               new_sport GET    /sports/new(.:format)                     sports#new</span>
<span class="go">                   sport DELETE /sports/:id(.:format)                     sports#destroy</span>
<span class="go">         dashboard_index GET    /dashboard(.:format)                      dashboard#index</span>
<span class="go">                   games GET    /games(.:format)                          games#index</span>
<span class="go">                         POST   /games(.:format)                          games#create</span>
<span class="go">                new_game GET    /games/new(.:format)                      games#new</span>
<span class="go">               edit_game GET    /games/:id/edit(.:format)                 games#edit</span>
<span class="go">                    game GET    /games/:id(.:format)                      games#show</span>
<span class="go">                         PUT    /games/:id(.:format)                      games#update</span>
<span class="go">                         DELETE /games/:id(.:format)                      games#destroy</span>
<span class="go">                    root        /                                         home#index</span>
</pre></div>

<p>You can see we now have games routes matching each of our actions. As a quick reminder of RESTful routes let&#39;s review the routes we&#39;ve created. I&#39;ve assumed we already have a game with the id 179:</p>

<table>
    <tr>
        <th>url</th>
        <th>action</th>
    </tr>
    <tr>
        <td>GET /games</td>
        <td>games#index</td>
    </tr>
    <tr>
        <td>POST /games</td>
        <td>games#create</td>
    </tr>
    <tr>
        <td>GET /games/new</td>
        <td>games#new</td>
    </tr>
    <tr>
        <td>GET /games/179/edit</td>
        <td>games#edit with params[:id] = 179</td>
    </tr>
    <tr>
        <td>GET /games/179</td>
        <td>games#show with params[:id] = 179</td>
    </tr>
    <tr>
        <td>PUT /games/179</td>
        <td>games#update with params[:id] = 179</td>
    </tr>
    <tr>
        <td>DELETE /games/179</td>
        <td>games#destroy with params[:id] = 179</td>
    </tr>
</table>

<p><a href="#top">back to top</a></p>

<h2><a id='our-draft-functional-tests-for-the-games-controller'></a> 8.2. Our draft functional tests for the games controller</h2>
<div class="highlight"><pre><span class="n">it</span> <span class="s1">&#39;should redirect users to the sign-in page when they are not signed-in&#39;</span>

<span class="n">it</span> <span class="s1">&#39;should display a list of the games belonging to the sign-in user&#39;</span>

<span class="n">it</span> <span class="s1">&#39;should create a new game when valid game parameters are provided&#39;</span>

<span class="n">it</span> <span class="s1">&#39;should redirect users back to the new page with user input when incorrect parameters are provided&#39;</span>

<span class="n">it</span> <span class="s1">&#39;should allow users to edit a game and update it when the values are valid&#39;</span>

<span class="n">it</span> <span class="s1">&#39;should allow users to edit a game and return then to the edit page with their edited input when incorrect parameters are provided&#39;</span>

<span class="n">it</span> <span class="s1">&#39;should allow users to view a game&#39;</span>

<span class="n">it</span> <span class="s1">&#39;should allow users to destroy a game and redirect them back to the index page&#39;</span>
</pre></div>

<p><a href="#top">back to top</a></p>

<h2><a id='testing-the-index-action'></a> 8.3. Testing the index action</h2>

<p><a href="#top">back to top</a></p>

<h2><a id='testing-the-new-create-actions'></a> 8.4. Testing the new/create actions</h2>

<p><a href="#top">back to top</a></p>

<h2><a id='testing-the-edit-updates-actions'></a> 8.5. Testing the edit/updates actions</h2>

<p><a href="#top">back to top</a></p>

<h2><a id='testing-the-show-action'></a> 8.6. Testing the show action</h2>

<p><a href="#top">back to top</a></p>

<h2><a id='testing-the-destroy-action'></a> 8.7. Testing the destroy action</h2>
